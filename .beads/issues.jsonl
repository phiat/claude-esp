{"id":"esp-0y9","title":"watcher: Fix memory leak in filePositions map","description":"The filePositions map tracks read positions for every file ever opened but never cleans up entries for files that no longer exist.\n\nIn long-running processes, this map grows indefinitely.\n\nFix: Periodically clean up entries for non-existent files.\n\nRef: watcher.go:40, 368-370","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T22:01:28.504868144-05:00","created_by":"phiat","updated_at":"2026-01-08T22:41:48.112043068-05:00","closed_at":"2026-01-08T22:38:40.436822514-05:00","close_reason":"Fixed all bugs","labels":["bug"]}
{"id":"esp-1q5","title":"watcher: Fix race condition on sessions map","description":"The sessions map is accessed concurrently without synchronization:\n- watchLoop() reads from w.sessions\n- checkForNewSessions() writes to w.sessions\n- Both run in separate goroutines with no mutex protection\n\nFix: Add sync.RWMutex to Watcher struct and protect all sessions map access.\n\nRef: watcher.go:228-246, 251-286","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T22:01:08.217549375-05:00","created_by":"phiat","updated_at":"2026-01-08T22:41:48.11167463-05:00","closed_at":"2026-01-08T22:08:25.320677729-05:00","close_reason":"Fixed - added sessionsMu sync.RWMutex to protect sessions map","labels":["bug"]}
{"id":"esp-2np","title":"tui: Session list (-l) includes agent files as sessions","description":"The ListSessions function in watcher.go returns agent JSONL files (agent-*.jsonl) as separate sessions. They should be filtered out since they're subagent logs within a session, not standalone sessions.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T21:32:52.282652274-05:00","created_by":"phiat","updated_at":"2026-01-08T22:41:48.113856697-05:00","closed_at":"2026-01-08T21:45:15.887399069-05:00","close_reason":"Fixed - added filter for agent-prefixed files in listSessionsFiltered()","labels":["bug"]}
{"id":"esp-2q4","title":"start stream from newest","description":"on start up, sometimes the conversation is long and catching up to it in the window takes a while.  if a long convo, lets start from the newest instead of scrolling all convo. still allow to scroll back to see earlier messages","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-08T22:17:29.750725975-05:00","created_by":"phiat","updated_at":"2026-01-08T22:47:01.316805886-05:00","closed_at":"2026-01-08T22:47:01.316805886-05:00","close_reason":"All P3 issues fixed"}
{"id":"esp-4fi","title":"refactor: Extract magic numbers to constants","description":"Multiple magic numbers scattered throughout: tree width (25), header height (4), scroll lines (3), buffer sizes (32*1024), cleanup interval (5 min). Add named constants to improve readability and maintainability. Locations: model.go:45,256,260,262, watcher.go:448,290","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-08T23:23:51.899753652-05:00","created_by":"phiat","updated_at":"2026-01-08T23:34:40.530685836-05:00","closed_at":"2026-01-08T23:34:40.530685836-05:00","close_reason":"Refactored in single commit"}
{"id":"esp-4tq","title":"refactor: Split watchLoop() into smaller functions","description":"The watchLoop() function (watcher.go:286-346) is 60+ lines and handles initialization, history skipping, and polling all in one. Split into performInitialRead() and runMainLoop() for better testability and readability.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-08T23:23:51.998085372-05:00","created_by":"phiat","updated_at":"2026-01-08T23:34:40.53704291-05:00","closed_at":"2026-01-08T23:34:40.53704291-05:00","close_reason":"Refactored in single commit"}
{"id":"esp-6jd","title":"watcher: Extract duplicated session filtering logic","description":"The same filtering logic for session files is duplicated 4 times in:\n- findSession\n- discoverActiveSessions  \n- checkForNewSessions\n- listSessionsFiltered\n\nFix: Extract to isMainSessionFile() helper function.\n\nRef: watcher.go:104-108, 188-193, 259-263, 398-403","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-08T22:01:29.339290272-05:00","created_by":"phiat","updated_at":"2026-01-08T22:47:01.335267769-05:00","closed_at":"2026-01-08T22:47:01.335267769-05:00","close_reason":"All P3 issues fixed","labels":["refactor"]}
{"id":"esp-8dv","title":"tui: Grey out inactive agents in tree view","description":"Agents accumulate in tree view and it's hard to tell which are active. \n\nImplementation:\n- Use file mtime to detect activity (modified in last 30-60 seconds = active)\n- Visual changes for inactive agents:\n  - Muted/grey text style\n  - Different icon (ðŸ¤– active vs ðŸ’¤ inactive)\n  - Sort order: active agents bubble to top, inactive sink down\n\nThis helps users focus on currently active agents during long sessions with many subagents.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-08T23:25:21.643742196-05:00","created_by":"phiat","updated_at":"2026-01-08T23:29:12.084320768-05:00","closed_at":"2026-01-08T23:29:12.084320768-05:00","close_reason":"Implemented inactive agent visual indicators: mtime-based activity detection, muted style + ðŸ’¤ icon for inactive agents, active agents sorted to top"}
{"id":"esp-9fa","title":"refactor: Extract duplicate Claude dir path construction","description":"The Claude directory path construction filepath.Join(homeDir, \".claude\", \"projects\") appears in multiple functions (watcher.go:98,604). Extract to a constant or helper function to reduce duplication and improve maintainability.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-08T23:23:51.796719743-05:00","created_by":"phiat","updated_at":"2026-01-08T23:34:40.535446082-05:00","closed_at":"2026-01-08T23:34:40.535446082-05:00","close_reason":"Refactored in single commit"}
{"id":"esp-9sw","title":"tui: Explore optional TV-themed UI","description":"Investigate a retro TV/CRT aesthetic for the TUI as an optional theme. Could include:\n- Scan lines effect\n- CRT curvature/vignette on borders\n- Phosphor glow on text\n- Static/noise effects for loading states\n- Channel-switching animation when toggling sessions\n- 'Tuning' effect when new content arrives\n- Retro color palette (green phosphor, amber, etc.)\n\nThis would be an optional --tv or --retro flag to enable the theme.","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-08T21:44:26.999904762-05:00","created_by":"phiat","updated_at":"2026-01-08T22:41:48.115256969-05:00"}
{"id":"esp-aek","title":"stream: Fix truncation message showing 0 lines","description":"The truncation message incorrectly calculates remaining lines:\n\nlines = lines[:s.maxLines]\nlines = append(lines, fmt.Sprintf('... (%d more lines)', len(lines)-s.maxLines))\n\nAfter truncating, len(lines) equals s.maxLines, so the result is always 0.\n\nFix: Store original count before truncating.\n\nRef: stream.go:217-220","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T22:01:26.911934524-05:00","created_by":"phiat","updated_at":"2026-01-08T22:41:48.113231521-05:00","closed_at":"2026-01-08T22:38:40.451211698-05:00","close_reason":"Fixed all bugs","labels":["bug"]}
{"id":"esp-alx","title":"watcher: Add context propagation for graceful shutdown","description":"The watcher is initialized without a context, making graceful shutdown difficult. The goroutine runs until Stop() is called, but if the TUI crashes, the goroutine may leak.\n\nFix: Pass context through initialization and use it in watchLoop.\n\nRef: model.go:67-86, watcher.go","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-08T22:01:30.175596897-05:00","created_by":"phiat","updated_at":"2026-01-08T22:47:01.330439268-05:00","closed_at":"2026-01-08T22:47:01.330439268-05:00","close_reason":"All P3 issues fixed","labels":["enhancement"]}
{"id":"esp-cro","title":"parser: Handle errors instead of ignoring them","description":"Several errors are silently ignored:\n1. Timestamp parsing (line 94) - results in zero-value timestamps\n2. JSON unmarshal in formatToolInput (line 192) - uses zero values\n\nFix: Add proper error handling with fallbacks.\n\nRef: parser.go:94, 192","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T22:01:08.422443309-05:00","created_by":"phiat","updated_at":"2026-01-08T22:41:48.113556029-05:00","closed_at":"2026-01-08T22:38:40.454915234-05:00","close_reason":"Fixed all bugs","labels":["bug"]}
{"id":"esp-e08","title":"parser: Fix potential index out of bounds on agentID","description":"Code assumes agentID has at least 7 characters:\n  agentName := fmt.Sprintf('Agent-%s', raw.AgentID[:7])\n\nThis will panic if agentID is shorter than 7 chars.\n\nFix: Use min(7, len(agentID)) like other places in codebase.\n\nRef: parser.go:117, 171","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T22:01:27.601338848-05:00","created_by":"phiat","updated_at":"2026-01-08T22:41:48.112634821-05:00","closed_at":"2026-01-08T22:38:40.445847329-05:00","close_reason":"Fixed all bugs","labels":["bug"]}
{"id":"esp-gcv","title":"all: Extract magic numbers to constants","description":"Multiple magic numbers should be constants:\n- 500ms poll interval\n- 100 channel buffer size\n- 5 minute active window\n- 1000 max stream items\n- 50 max lines per item\n\nFix: Define named constants for all magic numbers.\n\nRef: watcher.go:61,64,70, stream.go:37,59","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-08T22:01:31.015995974-05:00","created_by":"phiat","updated_at":"2026-01-08T22:47:01.325082691-05:00","closed_at":"2026-01-08T22:47:01.325082691-05:00","close_reason":"All P3 issues fixed","labels":["refactor"]}
{"id":"esp-lqk","title":"watcher: Fix race condition on Subagents map","description":"The session.Subagents map is modified by checkForNewSubagents() while being read by readSessionFiles().\n\nFix: Add mutex to Session struct or copy map before iteration.\n\nRef: watcher.go:289-308, 311-318","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T22:01:08.319472389-05:00","created_by":"phiat","updated_at":"2026-01-08T22:41:48.110373656-05:00","closed_at":"2026-01-08T22:08:25.365035952-05:00","close_reason":"Fixed - added mu sync.RWMutex to Session struct to protect Subagents map","labels":["bug"]}
